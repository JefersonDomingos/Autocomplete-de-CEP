// 1-- SELECIONAR OS ELEMENTOS QUE VÃO SER MANIPULADOS do DOM;

const addressForm = document.querySelector("#address-form");
const cepInput = document.querySelector("#cep");
const addressInput = document.querySelector("#address");
const cityInput = document.querySelector("#city");
const neighborhoodInput = document.querySelector("#neighborhood");
const regionInput = document.querySelector("#region");
const formInputs = document.querySelectorAll("[data-input]");

const closeButton = document.querySelector("#close-message");

///////////////////////////////////////////////

// 2 // validar cep permitir somente numeros

//quando apertar-mos alguma tecla "keypress" vai chamar uma função anônima, e posso
//acessar o evento pelo argumento (e);

cepInput.addEventListener("keypress", (e) => {
   
    //isso vai fazer aceitar apenas numeros e de 0 a 9
    const apenasNumeros = /[0-9]/;  
    //transformar a tecla digitada em uma string
    const key = String.fromCharCode(e.keyCode);


    console.log(e.keyCode) //keyCode responsável
    console.log(key) //tecla pressionada

    if(!apenasNumeros.test(key)){ //se a tecla for diferente de apenasNumeros
        e.preventDefault(); //para não prosseguir (usado também para não enviar formulario do submit)
        return //retornar para a proxima e verificar se é numérica

    }
});

3 //pegar o endereço através de um evento
// vamos usar o "keyup" pois ele aciona o evento somente depois que a tecla for digitada e solta
// no evento (e) vamos pegar o valor de cada tecla apertada  e.target.value e adicionar a inputValue

cepInput.addEventListener("keyup", (e) => {
const inputValue = e.target.value;

// e vamos checar se temos os 8 digitos que precisamos

if(inputValue.length === 8){
    //se tiver os 8 digitos vamos chamar a função getAddress() com o valor de inputValue;
    getAddress(inputValue);
}

});


4 //Pegar endereço pelo usando uma API;
// Na função getAddress(cep)  , cep se refere ao valor de inputValue;
// async significa que afunção é assíncrona e continua executando enquanto espera a API responder;

const getAddress = async (cep) => {
    toggleLoader(); //vai tornar o loader visível e invisível;
    cepInput.blur(); //vai retirar o cursor do input cep, vai diselecionar.
    const apiUrl = `https://viacep.com.br/ws/${cep}/json/`; //link da API que busca o endereço pelo CEP, em ${cep} está o valor do 
    //cep que digitamos para ser buscado e o /json/ ;//converte os dados da API para ficarem mais legíveis e podermos pega-los;
    const response = await fetch(apiUrl); //pegamos os dados que a API trouxe;
    const data = await response.json(); // tras os dados do endereço
    console.log(data) //imprimir os dados no console.
}   


5 //mostrar ou ocultar o carregamento da API

//toda vez que chamar a função toggleLoader (), fadeElement e loaderElement vão ficar ocultos se tiverem a "hide", 
//mas se não tiverem essa classe ela vai passar estar no elemento, tornando ele invisível;
//vamos chamar essa função dentro daquele if() que verifica se o cep tem os 8 digitos para que, se essa condição for verdadeira
// vai chamar essa função que mostrando os elementos faça a tela de carregamento.

const toggleLoader = () => {
    const fadeElement = document.querySelector("#fade");
    const loaderElement = document.querySelector("#loader");

    fadeElement.classList.toggle("hide");
    loaderElement.classList.toggle("hide");
}





